[TOC]

# 第2章-简单的HTTP协议

> Author: Crayon
>
> Date: 2020/10/08

## HTTP报文

### 请求报文

* 请求方法
* 请求URI
* 协议版本
* 请求首部字段
* 内容实体

```
POST[请求方法] /form/entry[请求URI] HTTP/1.1[版本协议]

[请求首部字段]
Host: hackr.jp
Connection: keep-alive
Connection-Type: application/x-www-form-urlencoded
Connection-Length: 1024

[内容实体]
name=ueno&age=99
```



### 响应报文

* 协议版本
* 状态码
* 状态码的原因短语
* 响应首部字段
* 实体

```
HTTP/1.1[协议版本] 200[状态码] OK[状态码的原因短语]

[响应首部字段]
Date: True, 10 Jul 2020 10:50:14 GMT
Content-Length: 256
Content-Type: text/html

[实体]
<html>
...
</html>
```



## HTTP设计特点

### 无状态

HTTP是一种无状态（stateless）协议，HTTP协议自身不对请求和响应之间的通信状态进行保存。在HTTP层面，协议对于发送过的请求或响应都不做持久化处理

* 设计从简，保证可快速处理大量事务，保证协议的可扩展性
* 正是因为HTTP协议简单，没有过多耦合功能，再加上其高可扩展性，才得以广泛使用

### 资源定位

HTTP协议使用URI定位互联网上的资源

* 请求报文中，`请求URI` `请求首部字段中的Host` `内容实体（如果包含query-string）`组成完整的URI
* 请求报文中，若不是访问特定资源，**只是对服务器本身发起请求**，可以用`*`作为请求URI

### 持久连接（HTTP1.1全面支持）

> 原来：在HTTP初始版本中，每进行一次HTTP通信就要断开一次TCP连接
>
> 特点：只要任意一端没有明确提出断开连接，则保持TCP连接状态

* 在请求Web页面需要短时间内多次从服务端获取多张图片时，无意义的TCP重复连接建立和端口增加通信量开销
* 持久连接减少了TCP连接重复建立和断开造成的额外开销
* **HTTP/1.0默认持久连接**

#### 管线化

* 不支持持久连接时，发送请求需要等待响应后才能发送下一个请求，是**串行化的**
* *持久连接使得多数请求以管线化（pipelining）方式发送成为可能，实现并行发送多个请求



## HTTP请求方法

| 方法    | 名称                   | 协议        | 备注                                                         |
| ------- | ---------------------- | ----------- | ------------------------------------------------------------ |
| GET     | 获取资源               | `1.0`/`1.1` |                                                              |
| POST    | 传输实体主体           | `1.0`/`1.1` |                                                              |
| PUT     | 传输文件               | `1.0`/`1.1` | `HTTP/1.1`的`PUT`方法自身不带验证机制，任何人都可上传文件，存在安全性问题。一般在采用`REST（Representational State Transfer）`或者实现验证机制的web网站上才会开启。 |
| DELETE  | 删除文件               | `1.0`/`1.1` | 1. 安全性同`PUT`<br />2. `PUT`/`DELETE`方法在资源存在或不存在时报错：`204 资源已存在/不存在` |
| HEAD    | 获取报文首部           | `1.0`/`1.1` | 和`GET`类似，不返回报文主体部分（比较快），一般用于确认URI的有效性及资源更新的日期时间等 |
| OPTIONS | 询问支持的方法         | `1.1`       | 1. 询问服务器支持的方法<br />2. 返回：`Allow: GET POST PUT ..` |
| TRACE   | 追踪路径               | `1.1`       | 1. 发送请求时在`Max-Forwards`首部字段中填入数组，每经过一个服务端该字段值-1，当数值降至0时，停止传输，**最后接收到请求的服务端**返回200响应<br />2. 客户端通过`TRACE`方法可以查询到请求是怎样被加工修饰的。通过设置`Max-Forwards`的数值，找出每一台中转服务器<br />3. 不常用，会引起**XST（Cross-Site Tracing，跨站追踪）攻击** |
| CONNECT | 要求用隧道协议链接代理 | `1.1`       | 1. 与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信<br />2. 主要使用**SSL（Secure Sockets Layer，安全套接层）**和**TLS（Transport Layer Security，传输层安全）**协议把通信内容加密后经过网络隧道传输<br />3. 方法格式：`CONNECT 代理服务器名:端口号 HTTP版本` |
| LINK    | 建立与资源之间的联系   | `1.0`       |                                                              |
| UNLINK  | 断开连接关系           | `1.0`       |                                                              |

